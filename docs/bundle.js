!function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=13)}({0:function(t,e){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(n=window)}t.exports=n},13:function(t,e,n){"use strict";n.r(e);var i=n(2),o=n.n(i),r={android:function(){return navigator.userAgent.match(/Android/i)},blackberry:function(){return navigator.userAgent.match(/BlackBerry/i)},ios:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},opera:function(){return navigator.userAgent.match(/Opera Mini/i)},windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return r.android()||r.blackberry()||r.ios()||r.opera()||r.windows()}},a=r,c=window.location.hostname.indexOf("localhost")>-1,s={};var l={send:function(t){var e=t.category,n=t.action,i=t.once;(function(t){var e=t.category,n=t.action;if(t.once){var i=e.toString().replace(/\W+/g,""),o=n.toString().replace(/\W+/g,""),r="".concat(i).concat(o);return!s[r]&&(s[r]=!0,!0)}return!0})({category:e,action:n,once:i})&&(c?console.log({category:e,action:n,once:i}):window.ga&&ga("send",{hitType:"event",eventCategory:e.toString(),eventAction:n.toString()}))}};function p(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var d={init:function(){d3.select(".header").select(".header-sub").selectAll("a").on("click",function(){l.send({category:"top-header-link-click",action:"click",once:!0})}),function(){var t=[-74.331,41.261],e=d3.select(".loading-overlay").select(".percent"),n=0,i=50;!function t(){e.transition().duration(i).on("end",function(e){n+=1,d3.select(this).text(n+"%"),i=31==n||12==n||38==n||21==n||66==n||88==n?750:50,n<100&&t()})}(),mapboxgl.accessToken="pk.eyJ1IjoiZG9jazQyNDIiLCJhIjoiY2pjazE5eTM2NDl2aDJ3cDUyeDlsb292NiJ9.Jr__XbmAolbLyzPDj7-8kQ";var o=new mapboxgl.Map({container:"map",style:"mapbox://styles/dock4242/cjnugndzr4rkn2spbxk0cnps5?optimize=true",center:[t[0],t[1]],zoom:6,pitch:0,bearing:0,interactive:!1});o.scrollZoom.disable(),o.on("load",function(t){});var r=new ScrollMagic.Controller,a=0,c=0;new ScrollMagic.Scene({triggerElement:"#fixed-map",duration:d3.select(".scroll__text").node().getBoundingClientRect().height-Math.max(document.documentElement.clientHeight,window.innerHeight||0)/2,offset:0,triggerHook:0}).setPin("#fixed-map",{pushfollowers:!1}).addTo(r),new ScrollMagic.Scene({triggerElement:"#tilt-shift-step",duration:d3.select("#tilt-shift-step").node().getBoundingClientRect().height,offset:0,triggerHook:.5}).on("progress",function(t){var e=t.progress;(e=Math.round(50*e)/50)!=a&&(a=e,o.jumpTo({pitch:60*a,bearing:0}))}).addTo(r),new ScrollMagic.Scene({triggerElement:"#rotate-step",duration:d3.select("#rotate-step").node().getBoundingClientRect().height,offset:0,triggerHook:.5}).on("progress",function(t){var e=t.progress;(e=Math.round(50*e)/50)!=c&&(c=e,o.jumpTo({bearing:-65.6*c,pitch:60}))}).addTo(r)}();var t="pk.eyJ1IjoiZG9jazQyNDIiLCJhIjoiY2pjazE5eTM2NDl2aDJ3cDUyeDlsb292NiJ9.Jr__XbmAolbLyzPDj7-8kQ",e=!0,n=7,i=d3.select("#content").node().getBoundingClientRect().width,o=Math.max(document.documentElement.clientHeight,window.innerHeight||0);!function(){var t=d3.select(".legend");t.append("p").attr("class","legend-title").text("Population / 1,000 sq. meters");var e=d3.format(","),n=t.selectAll("div").data([[1,"#fbeee0"],[250,"#f3ba7c"],[1500,"#f32020"],[5e3,"#830707"],[1e4,"#4b0707"]]).enter().append("div").attr("class","legend-box");n.append("div").attr("class","legend-color").style("background-color",function(t){return t[1]}),n.append("p").attr("class","legend-name").text(function(t){return e(4*t[0])})}();var r=.5,a=2;i<600&&(r=.75,a=1,console.log(o),console.log(o*r)),d3.select(".intro-image").append("img").attr("src",function(){return i<600?"https://api.mapbox.com/styles/v1/dock4242/cjo5tayip0w952rpski8ml7w0/static/95,12,2.64,0,50/"+Math.min(1280,i)+"x"+Math.min(Math.floor(o*r),500)+"@2x?access_token=pk.eyJ1IjoiZG9jazQyNDIiLCJhIjoiY2pjazE5eTM2NDl2aDJ3cDUyeDlsb292NiJ9.Jr__XbmAolbLyzPDj7-8kQ":"https://api.mapbox.com/styles/v1/dock4242/cjo5tayip0w952rpski8ml7w0/static/71.02,-1.29,2.64,0,60/"+Math.min(1280,i)+"x"+Math.min(Math.floor(o*r),500)+"@2x?access_token=pk.eyJ1IjoiZG9jazQyNDIiLCJhIjoiY2pjazE5eTM2NDl2aDJ3cDUyeDlsb292NiJ9.Jr__XbmAolbLyzPDj7-8kQ"}),d3.select(".intro-image").append("img").attr("src",function(){return i<600?"https://api.mapbox.com/styles/v1/dock4242/cjo5tayip0w952rpski8ml7w0/static/-97.677,12,2.64,0,50/"+Math.min(1280,i)+"x"+Math.min(Math.floor(o*r),500)+"@2x?access_token=pk.eyJ1IjoiZG9jazQyNDIiLCJhIjoiY2pjazE5eTM2NDl2aDJ3cDUyeDlsb292NiJ9.Jr__XbmAolbLyzPDj7-8kQ":"https://api.mapbox.com/styles/v1/dock4242/cjo5tayip0w952rpski8ml7w0/static/-26.55,-10.28,2.64,0,60/"+Math.min(1280,i)+"x"+Math.min(Math.floor(o*r),500)+"@2x?access_token=pk.eyJ1IjoiZG9jazQyNDIiLCJhIjoiY2pjazE5eTM2NDl2aDJ3cDUyeDlsb292NiJ9.Jr__XbmAolbLyzPDj7-8kQ"}),d3.select(".intro-image-two").append("div").append("img").attr("src",function(){return"https://api.mapbox.com/styles/v1/dock4242/cjoojxw063ksk2spglbhik1g8/static/35.28,31.9,6,-8,60/"+Math.floor(Math.min(1280,i/a))+"x"+Math.floor(Math.min(o*r,500))+"@2x?access_token=pk.eyJ1IjoiZG9jazQyNDIiLCJhIjoiY2pjazE5eTM2NDl2aDJ3cDUyeDlsb292NiJ9.Jr__XbmAolbLyzPDj7-8kQ"}),d3.select(".intro-image-two").append("div").append("img").attr("src",function(){return"https://api.mapbox.com/styles/v1/dock4242/cjoojxw063ksk2spglbhik1g8/static/126.79,37.38,6,-12.7,36.5/"+Math.floor(Math.min(1280,i/a))+"x"+Math.floor(Math.min(o*r,500))+"@2x?access_token=pk.eyJ1IjoiZG9jazQyNDIiLCJhIjoiY2pjazE5eTM2NDl2aDJ3cDUyeDlsb292NiJ9.Jr__XbmAolbLyzPDj7-8kQ"}),d3.select(".intro-image-two").append("div").append("img").attr("src",function(){return"https://api.mapbox.com/styles/v1/dock4242/cjoojxw063ksk2spglbhik1g8/static/-117.91,33.55,6,-0.67,60/"+Math.floor(Math.min(1280,i/a))+"x"+Math.floor(Math.min(o*r,500))+"@2x?access_token=pk.eyJ1IjoiZG9jazQyNDIiLCJhIjoiY2pjazE5eTM2NDl2aDJ3cDUyeDlsb292NiJ9.Jr__XbmAolbLyzPDj7-8kQ"}),d3.select(".intro-image-two").append("div").append("img").attr("src",function(){return"https://api.mapbox.com/styles/v1/dock4242/cjoojxw063ksk2spglbhik1g8/static/107.81,-6.76,6,0,47/"+Math.floor(Math.min(1280,i/a))+"x"+Math.floor(Math.min(o*r,500))+"@2x?access_token=pk.eyJ1IjoiZG9jazQyNDIiLCJhIjoiY2pjazE5eTM2NDl2aDJ3cDUyeDlsb292NiJ9.Jr__XbmAolbLyzPDj7-8kQ"});var c=.9,s=2;i*c<1300&&(s=2);var d=Math.min(Math.floor(i*c/s),450);i<500&&(d=Math.floor(i*c)-50),i<400&&(c=1,d=Math.floor(i*c)-20,console.log(d));var u=d,f=d3.select(".single-year-wrapper").selectAll("div").data([{city_name:"Paris",city_id:"paris",population:"10.9M People",city_text:"",location:{center:[2.228,48.88],pathString:"knxnCswrnT}qVaj~FveoI{fsDpvfAjuoH",zoom:7.13,bearing:-19.59,pitch:60}}]).enter().append("div").attr("class","img-wrapper"),g=f.append("div").attr("class",function(t){return"swiper-container "+t.city_id});function h(i,o,r){console.log(r);var a=i.location,c=a.bearing,s=a.pitch,l=a.center[1],p=a.center[0],f=a.zoom;a.pathString,e&&(f=n);var g="cjo5jr9510nfb2sp0ixdls6fw";return"3D"!=r&&(s=0),"medium"==o&&(f=6,g="cjoojxw063ksk2spglbhik1g8"),"medium-two"==o&&(f=5.1,g="cjoojxw063ksk2spglbhik1g8"),"medium-far"==o&&(f=4.2,g="cjo5tayip0w952rpski8ml7w0"),"super-far"==o&&(f=3,g="cjo5tayip0w952rpski8ml7w0"),"3D"!=r&&"close"!=o&&(s=0,g="cjo7b0rly2am02sqoz0b4zs0y"),"3D"!=r&&"close"==o&&(g="cjo7bhuwn056i2srxhhqjer8v"),"https://api.mapbox.com/styles/v1/dock4242/"+g+"/static/"+p+","+l+","+f+","+c+","+s+"/"+d+"x"+u+"@2x?access_token="+t}f.append("div").attr("class","text-column").append("p").attr("class","city-desc").html(function(t){return t.city_text});var m=g.append("div").attr("class","swiper-wrapper"),y=(g.append("div").attr("class","swiper-pagination"),["close","medium","medium-two","medium-far","super-far"]),v=m.selectAll("div").data(y).enter().append("div").attr("class","swiper-slide").style("width",d+"px").style("height",u+"px"),b=(v.filter(function(t,e){return console.log(e),0==e}).append("p").attr("class","city-title").html(function(t,e){return d3.select(this.parentNode.parentNode).datum().city_id,d3.select(this.parentNode.parentNode).datum().city_name+"<span>"+d3.select(this.parentNode.parentNode).datum().population+"</span>"}),v.filter(function(t,e){return"hong_kong"==d3.select(this.parentNode.parentNode).datum().city_id&&0==e}).append("div").attr("class","overlay-div").html('<svg viewBox="0 0 450 450" fill="none" xmlns="http://www.w3.org/2000/svg"> <text fill="black" xml:space="preserve" style="white-space: pre" font-family="Atlas Grotesk" font-size="16" font-weight="bold" letter-spacing="0em"><tspan x="315.281" y="318.992">Hong Kong</tspan></text> <text fill="black" xml:space="preserve" style="white-space: pre" font-family="Atlas Grotesk" font-size="16" font-weight="bold" letter-spacing="0em"><tspan x="176.023" y="342.992">Shenzhen</tspan></text> <text fill="black" xml:space="preserve" style="white-space: pre" font-family="Atlas Grotesk" font-size="16" font-weight="bold" letter-spacing="0em"><tspan x="35.0156" y="367.992">Guangzhou</tspan></text> <path d="M298.5 251.5C234 232 230.5 262.5 216 319" stroke="black" stroke-width="3"/> <path d="M168 162C94 199 58.9999 260 79.0002 348" stroke="black" stroke-width="3"/> </svg>'),v.append("div").attr("class","border-div"));v.append("div").attr("class","mask-div"),b.style("width",function(t,e){return 0==e?d+"px":1==e?"100px":2==e?"50px":3==e?"30px":"20px"}).style("height",function(t,e){return 0==e?u-40+"px":1==e?"100px":2==e?"50px":3==e?"30px":"20px"}),v.append("img").style("width",d+"px").style("height",u+"px").attr("src",function(t){return h(d3.select(this.parentNode.parentNode).datum(),t,"3D")}),g.append("p").attr("class","fraction").text("1/"+Math.ceil(y.length)),g.append("div").attr("class","city-toggles").selectAll("div").data(["3D","overhead"]).enter().append("div").attr("class","city-toggle").classed("city-toggle-active",function(t,e){return console.log(e),0==e}).on("click",function(t){!function(t,e){var n=e.city_id;g.filter(function(t,e){return t.city_id==n}).selectAll(".swiper-slide").select("img").attr("src",function(t){return""}),g.filter(function(t,e){return t.city_id==n}).selectAll(".swiper-slide").select("img").attr("src",function(e){return h(d3.select(this.parentNode.parentNode).datum(),e,t)})}(t,d3.select(this.parentNode).datum()),d3.select(this.parentNode).selectAll(".city-toggle").classed("city-toggle-active",!1),d3.select(this).classed("city-toggle-active",!0)}).append("p").attr("class","city-toggle-text").html(function(t){return t}),g.each(function(t,e,n){var i,o=d3.select(this);t.swiper=new Swiper("."+t.city_id,(p(i={spaceBetween:22,slidesPerView:s,grabCursor:!0,freeMode:!0,mousewheel:{invert:!0,forceToAxis:!0}},"slidesPerView","auto"),p(i,"slideToClickedSlide",!0),p(i,"pagination",{el:d3.select("."+t.city_id).select(".swiper-pagination").node(),clickable:!0}),p(i,"breakpoints",{920:{slidesPerView:2},500:{slidesPerView:1}}),i)),console.log(t),t.swiper.on("slideChange",function(){o.select(".fraction").text(t.swiper.activeIndex+1+"/"+Math.ceil(y.length))})}),d3.json("assets/data/world.json",function(t){var e=v.filter(function(t,e){return console.log(e),0==e}).append("div").attr("width","70px").attr("height","70px").attr("class","globe-wrapper");e.append("div").attr("class","globe-wrapper-svg-container").html('<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" viewBox="0 -256 1792 1792" id="svg3025" version="1.1" inkscape:version="0.48.3.1 r9886" width="100%" height="100%"> <g transform="matrix(1,0,0,-1,364.47458,1270.2373)"> <path d="m 768,896 q 0,106 -75,181 -75,75 -181,75 -106,0 -181,-75 -75,-75 -75,-181 0,-106 75,-181 75,-75 181,-75 106,0 181,75 75,75 75,181 z m 256,0 q 0,-109 -33,-179 L 627,-57 q -16,-33 -47.5,-52 -31.5,-19 -67.5,-19 -36,0 -67.5,19 Q 413,-90 398,-57 L 33,717 Q 0,787 0,896 q 0,212 150,362 150,150 362,150 212,0 362,-150 150,-150 150,-362 z" id="path3029" inkscape:connector-curvature="0" /> </g> </svg>'),e.append("canvas").attr("width",70).attr("height",70).each(function(e){e=d3.select(this.parentNode.parentNode.parentNode).datum();var n=d3.geoOrthographic().translate([35,35]).scale(30).rotate([-e.location.center[0],-e.location.center[1]]).clipAngle(90),i=n([e.location.center[0],e.location.center[1]]);d3.select(this.parentNode).select(".globe-wrapper-svg-container").style("transform","translate("+i[0]+"px,"+i[1]+"px)");var o=d3.select(this).node().getContext("2d"),r=d3.geoPath().projection(n).context(o),a=topojson.feature(t,t.objects.land);o.clearRect(0,0,70,70),o.beginPath(),o.arc(35,35,28,0,2*Math.PI,!0),o.fillStyle="#263138",o.fill(),o.beginPath(),r(a),o.fillStyle="#fff",o.fill()})})},resize:function(){}},u=d3.select("body"),f=0;function g(){var t=u.node().offsetWidth;f!==t&&(f=t,d.resize())}u.classed("is-mobile",a.any()),window.addEventListener("resize",o()(g,150)),function(){if(u.select("header").classed("is-sticky")){var t=u.select(".header__menu"),e=u.select(".header__toggle");e.on("click",function(){var n=t.classed("is-visible");t.classed("is-visible",!n),e.classed("is-visible",!n)})}}(),d.init()},2:function(t,e,n){(function(e){var n="Expected a function",i=NaN,o="[object Symbol]",r=/^\s+|\s+$/g,a=/^[-+]0x[0-9a-f]+$/i,c=/^0b[01]+$/i,s=/^0o[0-7]+$/i,l=parseInt,p="object"==typeof e&&e&&e.Object===Object&&e,d="object"==typeof self&&self&&self.Object===Object&&self,u=p||d||Function("return this")(),f=Object.prototype.toString,g=Math.max,h=Math.min,m=function(){return u.Date.now()};function y(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function v(t){if("number"==typeof t)return t;if(function(t){return"symbol"==typeof t||function(t){return!!t&&"object"==typeof t}(t)&&f.call(t)==o}(t))return i;if(y(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=y(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(r,"");var n=c.test(t);return n||s.test(t)?l(t.slice(2),n?2:8):a.test(t)?i:+t}t.exports=function(t,e,i){var o,r,a,c,s,l,p=0,d=!1,u=!1,f=!0;if("function"!=typeof t)throw new TypeError(n);function b(e){var n=o,i=r;return o=r=void 0,p=e,c=t.apply(i,n)}function w(t){var n=t-l;return void 0===l||n>=e||n<0||u&&t-p>=a}function x(){var t=m();if(w(t))return k(t);s=setTimeout(x,function(t){var n=e-(t-l);return u?h(n,a-(t-p)):n}(t))}function k(t){return s=void 0,f&&o?b(t):(o=r=void 0,c)}function j(){var t=m(),n=w(t);if(o=arguments,r=this,l=t,n){if(void 0===s)return function(t){return p=t,s=setTimeout(x,e),d?b(t):c}(l);if(u)return s=setTimeout(x,e),b(l)}return void 0===s&&(s=setTimeout(x,e)),c}return e=v(e)||0,y(i)&&(d=!!i.leading,a=(u="maxWait"in i)?g(v(i.maxWait)||0,e):a,f="trailing"in i?!!i.trailing:f),j.cancel=function(){void 0!==s&&clearTimeout(s),p=0,o=l=r=s=void 0},j.flush=function(){return void 0===s?c:k(m())},j}}).call(this,n(0))}});